<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Agent Workforce - System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: #fff; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #333; border-radius: 5px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 3px; }
        .pass { background: #2d5a2d; border-left: 4px solid #4caf50; }
        .fail { background: #5a2d2d; border-left: 4px solid #f44336; }
        .warning { background: #5a5a2d; border-left: 4px solid #ff9800; }
        .info { background: #2d2d5a; border-left: 4px solid #2196f3; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #test-output { background: #000; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>üß™ AI Agent Workforce System Test</h1>
    
    <div class="test-section">
        <h2>Configuration Tests</h2>
        <button onclick="testConfiguration()">Test Configuration</button>
        <div id="config-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Component Tests</h2>
        <button onclick="testComponents()">Test Components</button>
        <div id="component-results"></div>
    </div>
    
    <div class="test-section">
        <h2>API Tests</h2>
        <button onclick="testAPIs()">Test API Configuration</button>
        <div id="api-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Browser Compatibility</h2>
        <button onclick="testBrowserFeatures()">Test Browser Features</button>
        <div id="browser-results"></div>
    </div>
    
    <div class="test-section">
        <h2>System Integration</h2>
        <button onclick="testSystemIntegration()">Test Full System</button>
        <div id="integration-results"></div>
    </div>
    
    <div class="test-section">
        <h2>Test Output</h2>
        <div id="test-output"></div>
    </div>

    <!-- Load the same scripts as main app -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
    <script src="js/config.js?v=1.0.2"></script>
    <script src="js/agents.js?v=1.0.2"></script>
    <script src="js/specialized.js?v=1.0.2"></script>
    <script src="js/ui.js?v=1.0.2"></script>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('test-output');
            const timestamp = new Date().toLocaleTimeString();
            output.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function addResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function testConfiguration() {
            log('Starting configuration tests...', 'info');
            const container = 'config-results';
            document.getElementById(container).innerHTML = '';

            try {
                // Test CONFIG object exists
                if (typeof CONFIG === 'undefined') {
                    addResult(container, '‚ùå CONFIG object not found', 'fail');
                    return;
                }
                addResult(container, '‚úÖ CONFIG object loaded', 'pass');

                // Test required properties
                const requiredProps = [
                    'apis.openRouter',
                    'apis.elevenLabs', 
                    'agents.types',
                    'system.maxTasksPerAgent',
                    'ui.theme',
                    'voice.enabled',
                    'storage.persistState'
                ];

                requiredProps.forEach(prop => {
                    const value = prop.split('.').reduce((obj, key) => obj && obj[key], CONFIG);
                    if (value !== undefined) {
                        addResult(container, `‚úÖ CONFIG.${prop} exists`, 'pass');
                    } else {
                        addResult(container, `‚ùå CONFIG.${prop} missing`, 'fail');
                    }
                });

                // Test validation function
                if (typeof CONFIG.validate === 'function') {
                    const errors = CONFIG.validate();
                    if (errors.length === 0) {
                        addResult(container, '‚úÖ Configuration validation passed', 'pass');
                    } else {
                        addResult(container, `‚ö†Ô∏è Configuration validation warnings: ${errors.join(', ')}`, 'warning');
                    }
                } else {
                    addResult(container, '‚ùå CONFIG.validate function missing', 'fail');
                }

                log('Configuration tests completed', 'info');
            } catch (error) {
                addResult(container, `‚ùå Configuration test error: ${error.message}`, 'fail');
                log(`Configuration test error: ${error.message}`, 'fail');
            }
        }

        function testComponents() {
            log('Starting component tests...', 'info');
            const container = 'component-results';
            document.getElementById(container).innerHTML = '';

            try {
                // Test class definitions
                const classes = ['AgentManager', 'UIManager', 'VisionProcessor', 'ResearchEngine', 'AutomationEngine'];
                
                classes.forEach(className => {
                    if (typeof window[className] === 'function') {
                        addResult(container, `‚úÖ ${className} class defined`, 'pass');
                        
                        // Try to instantiate
                        try {
                            const instance = new window[className]();
                            addResult(container, `‚úÖ ${className} can be instantiated`, 'pass');
                        } catch (error) {
                            addResult(container, `‚ö†Ô∏è ${className} instantiation warning: ${error.message}`, 'warning');
                        }
                    } else {
                        addResult(container, `‚ùå ${className} class not found`, 'fail');
                    }
                });

                log('Component tests completed', 'info');
            } catch (error) {
                addResult(container, `‚ùå Component test error: ${error.message}`, 'fail');
                log(`Component test error: ${error.message}`, 'fail');
            }
        }

        function testAPIs() {
            log('Starting API tests...', 'info');
            const container = 'api-results';
            document.getElementById(container).innerHTML = '';

            try {
                // Test API configuration
                if (CONFIG.apis.openRouter.apiKey) {
                    addResult(container, '‚úÖ OpenRouter API key configured', 'pass');
                } else {
                    addResult(container, '‚ö†Ô∏è OpenRouter API key not configured', 'warning');
                }

                if (CONFIG.apis.elevenLabs.apiKey) {
                    addResult(container, '‚úÖ ElevenLabs API key configured', 'pass');
                } else {
                    addResult(container, '‚ö†Ô∏è ElevenLabs API key not configured (optional)', 'info');
                }

                // Test external libraries
                if (typeof tf !== 'undefined') {
                    addResult(container, '‚úÖ TensorFlow.js loaded', 'pass');
                } else {
                    addResult(container, '‚ùå TensorFlow.js not loaded', 'fail');
                }

                if (typeof Tesseract !== 'undefined') {
                    addResult(container, '‚úÖ Tesseract.js loaded', 'pass');
                } else {
                    addResult(container, '‚ùå Tesseract.js not loaded', 'fail');
                }

                log('API tests completed', 'info');
            } catch (error) {
                addResult(container, `‚ùå API test error: ${error.message}`, 'fail');
                log(`API test error: ${error.message}`, 'fail');
            }
        }

        function testBrowserFeatures() {
            log('Starting browser feature tests...', 'info');
            const container = 'browser-results';
            document.getElementById(container).innerHTML = '';

            try {
                const features = {
                    'Web Workers': typeof Worker !== 'undefined',
                    'Local Storage': typeof Storage !== 'undefined',
                    'Fetch API': typeof fetch !== 'undefined',
                    'WebRTC': typeof RTCPeerConnection !== 'undefined',
                    'Canvas': typeof HTMLCanvasElement !== 'undefined',
                    'Audio Context': typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined',
                    'Speech Synthesis': 'speechSynthesis' in window,
                    'Media Devices': navigator.mediaDevices && navigator.mediaDevices.getUserMedia,
                    'Notifications': 'Notification' in window,
                    'Service Worker': 'serviceWorker' in navigator,
                    'WebGL': typeof WebGLRenderingContext !== 'undefined',
                    'WebAssembly': typeof WebAssembly !== 'undefined'
                };

                Object.entries(features).forEach(([feature, supported]) => {
                    if (supported) {
                        addResult(container, `‚úÖ ${feature} supported`, 'pass');
                    } else {
                        addResult(container, `‚ùå ${feature} not supported`, 'warning');
                    }
                });

                log('Browser feature tests completed', 'info');
            } catch (error) {
                addResult(container, `‚ùå Browser feature test error: ${error.message}`, 'fail');
                log(`Browser feature test error: ${error.message}`, 'fail');
            }
        }

        function testSystemIntegration() {
            log('Starting system integration tests...', 'info');
            const container = 'integration-results';
            document.getElementById(container).innerHTML = '';

            try {
                // Test if we can create a basic agent
                if (typeof AgentManager === 'function') {
                    const agentManager = new AgentManager();
                    addResult(container, '‚úÖ AgentManager created successfully', 'pass');
                    
                    // Test agent creation
                    const testAgent = {
                        name: 'Test Agent',
                        type: 'general',
                        autonomyLevel: 'supervised'
                    };
                    
                    try {
                        const agent = agentManager.createAgent(testAgent);
                        addResult(container, '‚úÖ Test agent created successfully', 'pass');
                    } catch (error) {
                        addResult(container, `‚ö†Ô∏è Agent creation warning: ${error.message}`, 'warning');
                    }
                }

                // Test UI Manager
                if (typeof UIManager === 'function') {
                    const uiManager = new UIManager();
                    addResult(container, '‚úÖ UIManager created successfully', 'pass');
                }

                // Test specialized processors
                if (typeof VisionProcessor === 'function') {
                    const visionProcessor = new VisionProcessor();
                    addResult(container, '‚úÖ VisionProcessor created successfully', 'pass');
                }

                // Test storage functionality
                try {
                    localStorage.setItem('test_key', 'test_value');
                    const retrieved = localStorage.getItem('test_key');
                    localStorage.removeItem('test_key');
                    
                    if (retrieved === 'test_value') {
                        addResult(container, '‚úÖ Local storage working', 'pass');
                    } else {
                        addResult(container, '‚ùå Local storage not working', 'fail');
                    }
                } catch (error) {
                    addResult(container, `‚ùå Local storage error: ${error.message}`, 'fail');
                }

                log('System integration tests completed', 'info');
            } catch (error) {
                addResult(container, `‚ùå Integration test error: ${error.message}`, 'fail');
                log(`Integration test error: ${error.message}`, 'fail');
            }
        }

        // Auto-run basic tests on load
        window.addEventListener('load', () => {
            log('System test page loaded', 'info');
            log('Click the test buttons to run comprehensive tests', 'info');
        });
    </script>
</body>
</html>